<div
  x-data="{
    filter: {
      isShow: false,
      show() {
        overlay.show();
        this.isShow = true;
      },
      hide() {
        this.isShow = false;
        overlay.hide();
      }
    }
  }"
>
  <div class="mb-8 flex items-center text-gray-500">
    <div
      id="product-num"
      x-data="{
        get length() {
          return shop.filteredProducts.length;
        }
      }"
      x-text="`${length} product${length > 1 ? 's' : ''}`"
    ></div>
    <button
      id="filter-button"
      :class="btn.outlined"
      class="ml-auto rounded-3xl lg:hidden"
      @click="filter.show()"
    >
      <span x-html="svg('filter')"></span>&nbsp;Filters
    </button>
  </div>
  <div class="flex gap-x-12">
    <aside
      id="side-products-filter"
      class="block fixed left-0 top-0 w-full max-w-72 h-dvh flex flex-col justify-between bg-gray-100 select-none z-[1]"
      style="display: none"
      x-show="filter.isShow"
      x-transition:enter="transition ease-gentle duration-300"
      x-transition:enter-start="-translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transition ease-gentle duration-300"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="-translate-x-full"
      @click.outside="filter.hide()"
      @resize.window="filter.hide()"
    >
      <section class="px-8 pr-4 py-4 shadow flex justify-between items-center text-gray-500">
        <div
          x-data="{
            get length() {
              return shop.filteredProducts.length;
            }
          }"
          x-text="`${length} product${length > 1 ? 's' : ''}`"
        ></div>
        <button :class="btn.roundedLight" @click="filter.hide()">âœ•</button>
      </section>
      <div
        x-html="component('products-filter')"
        class="flex-1 px-8 overflow-y-auto"
      ></div>
    </aside>

    <aside
      id="products-filter-lg"
      x-html="component('products-filter')"
      class="hidden lg:block w-48 xl:w-56 select-none"
    ></aside>

    <div class="flex-1">
      <ul
        id="products"
        class="grid place-content-center grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-8 gap-y-12 tracking-wide"
      >
        <template x-for="product in shop.filteredProducts" :key="product.name">
          <li
            x-data="{
              lowerName: product.name.toLowerCase().replaceAll(' ', '_'),
              currentColor: product.colors[0],
            }"
            :class="product.stock !== 'in stock' && 'cursor-not-allowed'"
          >
            <div :class="product.stock !== 'in stock' && 'disabled'">
              <a
                :href="`#/shop/${product.category}/${lowerName}?color=${currentColor}`"
                class="block rounded-md overflow-hidden relative"
              >
                <img
                  :src="`./src/images/products/${lowerName}_${currentColor}.png`"
                  :alt="product.name"
                  loading="lazy"
                  class="min-w-full hover:brightness-95 transition duration-300"
                />
              </a>

              <div class="flex justify-between items-start">
                <div id="product-title">
                  <small class="text-xs font-semibold">
                    <template x-if="product.stock === 'in stock'">
                      <span
                        x-text="product.label && product.label[0].toUpperCase() + product.label.slice(1)"
                        class="text-red-500"
                      ></span>
                    </template>
                    <template x-if="product.stock !== 'in stock'">
                      <span
                        x-text="product.stock[0].toUpperCase() + product.stock.slice(1)"
                        class="text-blue-500"
                      ></span>
                    </template>
                  </small>
                  <a
                    :href="`#/shop/${product.category}/${lowerName}?color=${currentColor}`"
                    class="block mb-1"
                    :class="(product.stock === 'in stock' && !product.label.length) && 'mt-6'"
                  >
                    <h3
                      x-text="`${product.name}${product.colors.length > 1 ? ` (${currentColor})` : ''}`"
                      class="font-semibold"
                    ></h3>
                  </a>
                </div>
                <template x-if="product.stock === 'in stock'">
                  <button
                    id="cart-button"
                    x-html="svg('bag')"
                    class="mt-4 ml-1"
                    :class="btn.roundedLight"
                  ></button>
                </template>
              </div>

              <div id="product-price" class="space-x-1">
                <span
                  :class="product.discount && 'line-through text-gray-400'"
                  x-text="`$${product.price}`"
                ></span>
                <template x-if="product.discount">
                  <span
                    x-text="`$${Math.round(product.price * (100 - product.discount.split('%')[0]) / 100) }`"
                    class="text-gray-600"
                  ></span>
                  <span
                    x-text="`-${product.discount}`"
                    class="px-2 rounded-xl text-xs text-red-600 border border-red-600"
                  ></span>
                </template>
              </div>

              <template x-if="product.colors.length > 1">
                <div id="product-colors" class="mt-3 flex gap-x-1.5">
                  <template x-for="color in product.colors" :key="color">
                    <button
                      class="w-5 aspect-square rounded-full border border-gray-500 pointer"
                      :class="color"
                      :title="color"
                      @click="currentColor = color"
                    ></button>
                  </template>
                </div>
              </template>
            </div>
          </li>
        </template>
      </ul>
    </div>
  </div>
</div>
