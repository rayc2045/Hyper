<div
  x-data="{
    lowerName: product.name.toLowerCase().replaceAll(' ', '_'),
    currentColor: product.colors[0],
  }"
>
  <a
    :href="`#/shop/${product.category}/${lowerName}?color=${currentColor}`"
    class="block bg-neutral-200/75 rounded-md overflow-hidden"
  >
    <img
      :src="`./src/images/products/${lowerName}_${currentColor}.jpg`"
      :alt="product.name"
      loading="lazy"
      class="min-w-full mix-blend-multiply hover:brightness-95 transition duration-300"
    />
  </a>

  <div class="flex justify-between items-start">
    <div>
      <small
        id="product-label"
        x-text="product.stock === 'in stock' ? (product.label && product.label[0].toUpperCase() + product.label.slice(1)) : product.stock[0].toUpperCase() + product.stock.slice(1)"
        class="text-xs font-bold"
        :class="`text-${product.stock === 'in stock' ? 'red' : 'blue'}-500`"
      ></small>
      <a
        :href="`#/shop/${product.category}/${lowerName}?color=${currentColor}`"
        class="block mb-1"
        :class="(product.stock === 'in stock' && !product.label.length) && 'mt-6'"
      >
        <h3
          id="product-title"
          x-text="`${product.name}${product.colors.length > 1 ? ` (${currentColor})` : ''}`"
          class="text-lg font-bold"
        ></h3>
      </a>
    </div>
    <template x-if="product.stock === 'in stock'">
      <button
        id="cart-button"
        x-html="svg('bag')"
        class="mt-5 ml-1"
        :class="btn.roundedGray"
        @click="await cart.addItem({
          name: product.name,
          color: currentColor,
          category: product.category,
          price: product.price,
          discount: product.discount,
          SKU: product.SKU,
        })"
      ></button>
    </template>
  </div>

  <div class="flex space-x-2">
    <span
      id="original-price"
      x-text="`$${thousandFormat(product.price)}`"
      :class="product.discount && 'line-through text-gray-400'"
    ></span>
    <template x-if="product.discount">
      <div class="flex items-center space-x-2">
        <span
          id="new-price"
          x-text="`$${thousandFormat(Math.round(product.price * (100 - product.discount.split('%')[0]) / 100))}`"
        ></span>
        <span
          id="discount-badge"
          x-text="`-${product.discount}`"
          class="px-2 py-0.5 rounded-xl text-xs text-red-600 border border-red-600"
        ></span>
      </div>
    </template>
  </div>

  <template x-if="product.colors.length > 1">
    <div id="colors" class="mt-3 flex gap-x-1.5">
      <template x-for="color in product.colors" :key="color">
        <div
          class="p-0.5 border rounded-full flex justify-center items-center"
          :class="color === currentColor ? 'border-gray-500' : 'border-transparent'"
        >
          <button
            class="w-5 aspect-square rounded-full border border-gray-500 pointer"
            :class="color"
            :title="color"
            @click="currentColor = color"
          ></button>
        </div>
      </template>
    </div>
  </template>
</div>
